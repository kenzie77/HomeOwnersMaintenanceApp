<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="HomeMaintenanceApp.Pages.HurricanePage"
             Title="Hurricane Prep">

    <VerticalStackLayout Padding="12" Spacing="12" BackgroundColor="#101820">

        <!-- ===== HEADER AREA (FIXED: no overlap, no running into each other) ===== -->
        <FlexLayout Direction="Row"
                    Wrap="Wrap"
                    AlignItems="Center"
                    JustifyContent="SpaceBetween"
                    ColumnSpacing="10"
                    RowSpacing="6">

            <!-- Left: Title -->
            <Label Text="Hurricane preparedness checklist"
                   FontSize="20"
                   FontAttributes="Bold"
                   TextColor="White"
                   FlexLayout.Grow="1"
                   LineBreakMode="NoWrap" />

            <!-- Center tagline -->
            <Label Text="Add • Edit • Delete"
                   TextColor="#93c5fd"
                   FontSize="13"
                   LineBreakMode="NoWrap"
                   VerticalOptions="Center"
                   FlexLayout.Grow="0" />

            <!-- Right: Delete Selected Button -->
            <Border x:Name="DeleteSelectedPanel"
                    BackgroundColor="#ef4444"
                    Stroke="#ef4444"
                    Padding="10,6"
                    StrokeThickness="1"
                    VerticalOptions="Center">

                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="6"/>
                </Border.StrokeShape>

                <HorizontalStackLayout Spacing="6">

                    <Image Source="trash.png"
                           HeightRequest="18"
                           WidthRequest="18"
                           Aspect="AspectFit"/>

                    <Label Text="Delete Selected"
                           TextColor="White"
                           FontAttributes="Bold"
                           FontSize="13"
                           LineBreakMode="NoWrap"/>
                </HorizontalStackLayout>

                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnDeleteSelectedTapped"/>
                </Border.GestureRecognizers>

            </Border>

        </FlexLayout>
        <!-- ===== END HEADER FIX ===== -->


        <!-- Add new item row -->
        <Border BackgroundColor="#1F2937" Stroke="#334155">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="8"/>
            </Border.StrokeShape>

            <Grid ColumnDefinitions="*,Auto" Padding="12">
                <Entry x:Name="NewHItemEntry"
                       Placeholder="Add a checklist item..."
                       TextColor="White"
                       PlaceholderColor="#cbd5e1"
                       BackgroundColor="#0f1d2f"
                       HorizontalOptions="Fill" />

                <Button Grid.Column="1"
                        Text="Add"
                        BackgroundColor="#2563eb"
                        TextColor="White"
                        Padding="12,6"
                        CornerRadius="8"
                        Clicked="OnAddHItem"/>
            </Grid>
        </Border>


        <!-- Checklist list -->
        <CollectionView x:Name="HList"
                        BackgroundColor="#0f1d2f"
                        SelectionMode="None"
                        ItemsLayout="VerticalList">

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <SwipeView>

                        <SwipeView.RightItems>
                            <SwipeItems Mode="Reveal">
                                <SwipeItem Text="Edit"
                                           BackgroundColor="#3b82f6"
                                           Invoked="OnEditSwipe" />

                                <SwipeItem Text="Delete"
                                           BackgroundColor="#ef4444"
                                           Invoked="OnDeleteSwipe" />
                            </SwipeItems>
                        </SwipeView.RightItems>

                        <!-- Row -->
                        <Grid Padding="10"
                              ColumnDefinitions="Auto,*,Auto"
                              ColumnSpacing="12">

                            <!-- Checkbox -->
                            <CheckBox IsChecked="{Binding IsSelected}"
                                      Color="#60a5fa"
                                      CheckedChanged="OnRowSelectedChanged" />

                            <!-- Text (tap to edit) -->
                            <Label Grid.Column="1"
                                   Text="{Binding Text}"
                                   TextColor="White"
                                   LineBreakMode="WordWrap">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnRowTapped" />
                                </Label.GestureRecognizers>
                            </Label>

                            <!-- Per-row Delete -->
                            <Button Grid.Column="2"
                                    BackgroundColor="#ef4444"
                                    TextColor="White"
                                    Padding="10,6"
                                    CornerRadius="6"
                                    FontSize="13"
                                    Text="Delete"
                                    Clicked="OnDeleteRowClicked"
                                    HorizontalOptions="End"
                                    VerticalOptions="Center" />

                        </Grid>

                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>


        <!-- Tip -->
        <Label Text="Tip: Check items then tap the red Delete Selected button; tap text to edit; swipe → Edit/Delete; per-row red Delete removes one."
               TextColor="#9ca3af"
               FontSize="12"
               LineBreakMode="WordWrap" />

    </VerticalStackLayout>
</ContentPage>