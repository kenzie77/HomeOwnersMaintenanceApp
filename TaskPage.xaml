<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="HomeMaintenanceApp.Pages.TaskPage"
             Title="Tasks"
             BackgroundColor="#101820">

    <Grid RowDefinitions="Auto,*" Padding="12" RowSpacing="10">

        <!-- Header -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto" VerticalOptions="Center">
            <Label Text="Tasks"
                   FontSize="22"
                   FontAttributes="Bold"
                   TextColor="White"
                   VerticalOptions="Center"/>

            <Button Text="Add Task"
                    Grid.Column="1"
                    HorizontalOptions="End"
                    VerticalOptions="Center"
                    Padding="12,6"
                    CornerRadius="10"
                    FontSize="14"
                    Clicked="OnAddTaskClicked"/>
        </Grid>

        <!-- Task list -->
        <CollectionView Grid.Row="1"
                        x:Name="TaskList"
                        BackgroundColor="#0f1d2f"
                        SelectionMode="None"
                        ItemSizingStrategy="MeasureAllItems">

            <CollectionView.ItemTemplate>
                <DataTemplate>

                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems Mode="Reveal">
                                <SwipeItem Text="Complete"
                                           BackgroundColor="#10b981"
                                           Invoked="OnCompleteSwipe" />
                                <SwipeItem Text="Delete"
                                           BackgroundColor="#ef4444"
                                           Invoked="OnDeleteSwipe" />
                            </SwipeItems>
                        </SwipeView.RightItems>

                        <!-- Card -->
                        <Frame BackgroundColor="#374151"
                               BorderColor="#1f2a3a"
                               CornerRadius="14"
                               Padding="12"
                               Margin="0,6"
                               HasShadow="False">

                            <Grid RowDefinitions="Auto,Auto,Auto"
                                  RowSpacing="10">

                                <!-- Title + Description -->
                                <VerticalStackLayout Grid.Row="0" Spacing="3">
                                    <Label Text="{Binding Title}"
                                           TextColor="White"
                                           FontAttributes="Bold"
                                           FontSize="17"
                                           LineBreakMode="TailTruncation"/>

                                    <Label Text="{Binding Description}"
                                           TextColor="#e5e7eb"
                                           FontSize="13"
                                           LineBreakMode="WordWrap"/>
                                </VerticalStackLayout>

                                <!-- Controls (responsive) -->
                                <Grid Grid.Row="1"
                                      ColumnDefinitions="*,*"
                                      RowDefinitions="Auto,Auto"
                                      ColumnSpacing="10"
                                      RowSpacing="8">

                                    <!-- Priority -->
                                    <VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="2">
                                        <Label Text="Priority"
                                               TextColor="#93c5fd"
                                               FontSize="11"/>
                                        <Picker Title="Priority"
                                                FontSize="14"
                                                HeightRequest="45"
                                                TextColor="White"
                                                SelectedIndexChanged="OnPriorityChanged">
                                            <Picker.Items>
                                                <x:String>Low</x:String>
                                                <x:String>Medium</x:String>
                                                <x:String>High</x:String>
                                                <x:String>Critical</x:String>
                                            </Picker.Items>
                                        </Picker>
                                    </VerticalStackLayout>

                                    <!-- Status -->
                                    <VerticalStackLayout Grid.Row="0" Grid.Column="1" Spacing="2">
                                        <Label Text="Status"
                                               TextColor="#93c5fd"
                                               FontSize="11"/>
                                        <Picker Title="Status"
                                                FontSize="14"
                                                HeightRequest="45"
                                                TextColor="White"
                                                SelectedIndexChanged="OnStatusChanged">
                                            <Picker.Items>
                                                <x:String>NotStarted</x:String>
                                                <x:String>InProgress</x:String>
                                                <x:String>Completed</x:String>
                                                <x:String>Deferred</x:String>
                                            </Picker.Items>
                                        </Picker>
                                    </VerticalStackLayout>

                                    <!-- Due Date -->
                                    <VerticalStackLayout Grid.Row="1" Grid.ColumnSpan="2" Spacing="2">
                                        <Label Text="Due Date"
                                               TextColor="#93c5fd"
                                               FontSize="11"/>
                                        <DatePicker Date="{Binding DueDate}"
                                                    FontSize="14"
                                                    HeightRequest="45"
                                                    TextColor="White"
                                                    DateSelected="OnDueDateSelected"/>
                                    </VerticalStackLayout>

                                </Grid>

                                <!-- Actions row -->
                                <Grid Grid.Row="2" ColumnDefinitions="Auto,Auto,*" ColumnSpacing="10" RowSpacing="6">

                                    <Button Text="Start"
                                            BackgroundColor="#3b82f6"
                                            TextColor="White"
                                            Padding="12,6"
                                            CornerRadius="10"
                                            FontSize="14"
                                            Clicked="OnStartClicked"/>

                                    <Button Text="Done"
                                            Grid.Column="1"
                                            BackgroundColor="#10b981"
                                            TextColor="White"
                                            Padding="12,6"
                                            CornerRadius="10"
                                            FontSize="14"
                                            Clicked="OnDoneClicked"/>

                                    <VerticalStackLayout Grid.Column="2" Spacing="2">
                                        <Label Text="{Binding Recurrence}"
                                               TextColor="#e5e7eb"
                                               FontSize="13"
                                               LineBreakMode="TailTruncation"/>

                                        <Label Text="{Binding DueDate, StringFormat='Next due: {0:MMM d, yyyy}'}"
                                               TextColor="#cbd5e1"
                                               FontSize="13"
                                               LineBreakMode="TailTruncation"/>
                                    </VerticalStackLayout>

                                </Grid>

                                <!-- Completed date (hidden if null) -->
                                <Label Grid.Row="3"
                                       Text="{Binding LastCompletedOn, StringFormat='Completed: {0:MMM d, yyyy}'}"
                                       TextColor="#93c5fd"
                                       FontSize="12"
                                       IsVisible="True">
                                    <Label.Triggers>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding LastCompletedOn}"
                                                     Value="{x:Null}">
                                            <Setter Property="IsVisible" Value="False" />
                                        </DataTrigger>
                                    </Label.Triggers>
                                </Label>

                            </Grid>
                        </Frame>
                    </SwipeView>

                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </Grid>
</ContentPage>

